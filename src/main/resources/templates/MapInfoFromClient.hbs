<!DOCTYPE html>
<html>
    <head>
        <title>MAIN</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="/css/lib/bootstrap.min.css">
        <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=9bt34yijp5"></script>
    </head>

    <body>
        <h1> MAP 검색 </h1>


        <input type="text" id="location" placeholder="주소를 입력하세요"></input>
        <input type="button" class="location_search" value=" 검색 " > </input>

        <div id="map" style = "width:100%; height: 400px;"></div>

        <script src="/js/lib/jquery.min.js"></script>
        <script src="/js/lib/bootstrap.min.js"></script>
        <script>
            var searchBtnHtml = '<input type="text" placeholder="동으로 검색"></input> ';
           var locationBtnHtml = '<a href="#" class="btn_mylct"><span class="spr_trff spr_ico_mylct">NAVER 그린팩토리</span></a>';
            $(function(){
                var x,y;

                $('.location_search').click(function(){
                    var location = $('#location').val();
                    console.log("value ="+ location);

                    var param = {
                        location: location
                    };

                    var progress = '<img src="../image/progress.gif">';
                    $('#map').append(progress);

                    $.get('../whatlocation',param,function(data){
                        console.log("type is="+typeof data);
                        console.log(JSON.parse(data));

                        //x는 경도 y는 위도를 나타냄
                        x = JSON.parse(data).addresses[0].x;
                        y = JSON.parse(data).addresses[0].y;

                        var mapOptions = {
                            center: new naver.maps.LatLng(y,x),
                            zoom: 15
                        };
                        var map = new naver.maps.Map('map',mapOptions);

                       naver.maps.Event.once(map, 'init_stylemap', function () {
                            //customControl 객체 이용하기
                            var customControl = new naver.maps.CustomControl(locationBtnHtml, {
                                position: naver.maps.Position.TOP_LEFT
                            });

                            customControl.setMap(map);

                            var domEventListener = naver.maps.Event.addDOMListener(customControl.getElement(), 'click', function() {
                                map.setCenter(new naver.maps.LatLng(37.3595953, 127.1053971));
                            });

                            //Map 객체의 controls 활용하기
                            var $locationBtn = $(locationBtnHtml),
                                locationBtnEl = $locationBtn[0];

                            map.controls[naver.maps.Position.LEFT_CENTER].push(locationBtnEl);

                            var domEventListener = naver.maps.Event.addDOMListener(locationBtnEl, 'click', function() {
                                map.setCenter(new naver.maps.LatLng(37.3595953, 127.1553971));
                            });
                        });
                    });
                });
            })
        </script>
    </body>

</html>