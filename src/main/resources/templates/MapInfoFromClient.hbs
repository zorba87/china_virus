<!DOCTYPE html>
<html>
    <head>
        <title>MAIN</title>
        <meta http-equiv="Content-Type" content="text/html; charset=UTF-8"/>
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no">
        <link rel="stylesheet" href="/css/lib/bootstrap.min.css">
        <script type="text/javascript" src="https://openapi.map.naver.com/openapi/v3/maps.js?ncpClientId=9bt34yijp5"></script>

        <!--for autocomplete -->
        <link rel="stylesheet" href="//code.jquery.com/ui/1.12.1/themes/base/jquery-ui.css">

    </head>

    <body>
        <h1> MAP 검색 </h1>

        <div id="map" style = "width:100%; height: 600px;"></div>

        <script src="/js/lib/jquery.min.js"></script>
        <script src="/js/lib/bootstrap.min.js"></script>
        <!--for autocomplete -->
        <script src="https://code.jquery.com/ui/1.12.1/jquery-ui.js"></script>

        <script>
            $(function(){
                var x,y;

                var locationBtnHtml = '<input type = "text" id="location" placeholder="동으로 검색"><span class="spr_trff spr_ico_mylct"></span></input>';
                var searchBtnHtml = '<input type= "button" class="location_search" value="검색"/>'

                var map = new naver.maps.Map('map', {
                    useStyleMap: true,
                    zoom: 13
                });
                naver.maps.Event.once(map, 'init_stylemap', function () {
                    //0. customControl 객체 이용하기
                    var customControl = new naver.maps.CustomControl(locationBtnHtml, {
                        position: naver.maps.Position.TOP_LEFT
                    });

                    var searchControl = new naver.maps.CustomControl(searchBtnHtml, {
                        position: naver.maps.Position.TOP_LEFT
                    });

                    customControl.setMap(map);
                    searchControl.setMap(map);

                    var availableCity = ["서울","부산","대구","광주","울산"];

                    $("#location").autocomplete({
                        source: availableCity,

                        select: function(event, ui) {
                            console.log(ui.item);
                        },
                        focus: function(event, ui) {
                            return false;
                            //event.preventDefault();
                        }
                    });

                    var domEventListener = naver.maps.Event.addDOMListener(searchControl.getElement(), 'click', function() {
                        //Todo
                        // 0.Auto suggestion

                        // 1.search btn in textbox
                        var location = $('#location').val();
                        console.log("value ="+ location);

                        var param = {
                            location: location
                        };

                        var progress = '<img src="../image/progress.gif">';
                        $('#map').append(progress);

                        $.get('../whatlocation',param,function(data){
                            console.log("type is="+typeof data);
                            console.log(JSON.parse(data));

                            //x는 경도 y는 위도를 나타냄
                            x = JSON.parse(data).addresses[0].x;
                            y = JSON.parse(data).addresses[0].y;

                            var mapOptions = {
                                center: new naver.maps.LatLng(y,x),
                                zoom: 15
                            };
                            var map = new naver.maps.Map('map',mapOptions);

                        });

                    });
                });

            })
        </script>
    </body>

</html>